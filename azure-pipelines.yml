
trigger:
- main

pr:
  branches:
    include:
    - main

jobs:
- job: CI
  workspace:
    clean: all
    
  pool:
    name: nitsm-python-test

  # py -3 indicates the latest python version installed on the system
  steps:
  - script: |
      py -3 -m pip install --upgrade pip
    displayName: 'Upgrade pip'

  - script: |
      py -3 -m pip install --upgrade tox
    displayName: 'Install or upgrade tox'

  - script: |
      tox
    displayName: 'Run python unit tests'

  - task: PublishTestResults@2
    condition: succeededOrFailed()
    inputs:
      testResultsFiles: '**/*-results.xml'
      testRunTitle: 'Publish test results'
    displayName: 'Display test results'

  - task: PublishCodeCoverageResults@1
    inputs:
      codeCoverageTool: Cobertura
      summaryFileLocation: '$(System.DefaultWorkingDirectory)/**/coverage.xml'
    displayName: 'Display code coverage results'
